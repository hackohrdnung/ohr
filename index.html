<!DOCTYPE html>
<html>

<!--************************************************************************** -->
<!-- Head                                                                      -->
<!--************************************************************************** -->
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="user-scalable     = no, 
                                   initial-scale     = 1, 
                                   maximum-scale     = 1, 
                                   minimum-scale     = 1, 
                                   width             = device-width"/>
    <title>Gehörschutz Check</title>
    <!-- Externe Styles und Scripts  -->
    <link rel="stylesheet" href="style.css">
    <script src="script.js"></script>
    <script src="cordova.js"></script>
    <!-- Interne Styles und Scripts  -->
    <style>
        @font-face{
            font-family:        "Material Icons";
            font-style:         normal;
            font-weight:        400;
            src:                url(icons.woff) format("woff");
        }
        @font-face{
            font-family:        "Roboto";
            font-style:         normal;
            font-weight:        300;
            src:                url(fontR300.woff) format("woff");
        }
        @font-face{
            font-family:        "Roboto";
            font-style:         normal;
            font-weight:        400;
            src:                url(fontR400.woff) format("woff");
        }
        @font-face{
            font-family:        "Roboto";
            font-style:         italic;
            font-weight:        400;
            src:                url(fontR400i.woff) format("woff");
        }
        @font-face{
            font-family:        "Roboto";
            font-style:         normal;
            font-weight:        500;
            src:                url(fontR500.woff) format("woff");
        }
        @font-face{
            font-family:        "Roboto";
            font-style:         normal;
            font-weight:        700;
            src:                url(fontR700.woff) format("woff");
        }
        .header{
            margin:             0px;
            padding:            0px;
        }
        .material-icons{
            font-family:        "Material Icons";
            font-weight:        normal;
            font-style:         normal;
            font-size:          36px; 
            display:            inline-block;
            line-height:        1;
            text-transform:     none;
            letter-spacing:     normal;
            word-wrap:          normal;
            vertical-align:     top;
            padding-bottom:     4px;
            padding-top:        4px;
            white-space:        nowrap;
            direction:          ltr;
            -webkit-font-smoothing:  antialiased;
            text-rendering:          optimizeLegibility;
            -moz-osx-font-smoothing: grayscale;
            font-feature-settings:   "liga";
        }
        .narrowButton{
            margin:             0px;
            max-width:          60px;
            min-width:          60px;
            margin:             0px;
            width:              60px;
        }
        .headerButton{
            font-size:          1.3em;
            height:             50px;
            padding-top:        5px;
        }
        .title{
            padding-top:        5px;
            width:              calc(100% - 120px);
        }
        .unters{
            margin-top:         50px;
        }
        h1{
            font-size:          1.3em;
            font-weight:        400;
            margin:             0px;
            padding:            0px;
            padding-top:        10px;
            text-align:         center;
        }
        h2{
            font-size:          1.1em;
            font-weight:        400;
            margin:             0px;
            padding:            0px;
            padding-left:       10px;
            padding-top:        12px;
            text-align:         left;
        }
    </style>
    <script>
        //Media Plugin fertig laden
        document.addEventListener('deviceready', init, false);
        var isAndroid = false;
        function init() {
            if(device.platform.toLowerCase() === "android"){
                isAndroid = true;
            }
        }
        //AngularJS Material Script
        var app = angular.module("myApp", ["ngMaterial", "ngMessages"]);
        app.config(function($mdThemingProvider){
            $mdThemingProvider
                .theme("default")
                //.dark()
                .primaryPalette("orange")
                .accentPalette("cyan");
        });
        app.controller("myCtrl", function($scope, $mdDialog){
            $scope.counter = 0;
            $scope.media   = null;
            $scope.volume  = 100;
            $scope.new = function(){
                $scope.stop();
                $scope.volume = 100;
            }
            $scope.info = function(){
                var confirm =   $mdDialog.confirm({onComplete: function(){}})
                    .title("Bitte eine Distanz von 30cm einhalten")
                    .textContent("")
                    .targetEvent(event)
                    .ok("Schliessen")
                $mdDialog.show(confirm).then(function(){
                });
            }
            $scope.getCordovaPath = function() {
                var path = window.location.pathname;
                if(isAndroid){
                    path = "/android_asset/www/";
                } 
                //path = cordova.file.applicationDirectory + 'www/'
                //path = path.substr( path, path.length - 23 );
                //path = path + 'audio/'+audiofile+'.mp3';
                return 'file://' + path;
            }
            $scope.start = function(){
                try{
                    $scope.media = new Media($scope.getCordovaPath() + "4khz.mp3", 
                        function(){console.log("Success")}, 
                        function(error){console.log("Error: " + JSON.stringify(error))});
                }catch(error){
                    console.log("Keine Media-Bibliothek gefunden")
                }
                if($scope.media){
                    $scope.media.play({ numberOfLoops: 3 });
                    $scope.counter = 3;
                }
            };
            $scope.stop = function(){
                if($scope.media){
                    $scope.media.stop();
                }
            };
            $scope.volumeUp = function(){
                if($scope.media){
                    if($scope.volume<100){
                        $scope.volume+=5;
                    }
                    $scope.media.setVolume($scope.volume / 100);
                }
            };
            $scope.volumeDown = function(){
                if($scope.media){
                    if($scope.volume>0){
                        $scope.volume-=5;
                    }
                    $scope.media.setVolume($scope.volume / 100);
                }
            };
        });
    </script>
</head>

<!--************************************************************************** -->
<!-- Body                                                                      -->
<!--************************************************************************** -->
<body ng-app="myApp" ng-controller="myCtrl" id="bodyID">
<md-content>

    <!--********************************************************************** -->
    <!-- Body: Header                                                          -->
    <!--********************************************************************** -->
    <div layout="row" layout-align="center" class="header">
        <div style="width: 60px;">
            <md-button aria-label = "New"
                       class      = "md-primary narrowButton headerButton"
                       ng-click   = "new()">Neu</md-button>
        </div>
        <div layout-align="center" class="title">
            <h1>Gehörschutz Check</h1>
        </div>
        <div style="width: 60px;">
            <md-button aria-label = "Info"
                       class      = "md-primary narrowButton headerButton"
                       ng-click   = "info()">Info</md-button>
        </div>
    </div>
    <md-divider></md-divider>

    <!--********************************************************************** -->
    <!-- Body: Ohne Gehörschutz                                                -->
    <!--********************************************************************** -->
    <div layout="row" layout-align="center" class="unters">
        <md-button ng-click="start()" class="md-primary">Start</md-button>
    </div>
    <div layout="row" layout-align="center" class="unters">
        <md-button ng-click="stop()" class="md-primary">Stop</md-button>
    </div>
    <div layout="row" layout-align="center" class="unters">
        <md-button ng-click="volumeUp()" class="md-primary">Lauter</md-button>
    </div>
    <div layout="row" layout-align="center" class="unters">
        <md-button ng-click="volumeDown()" class="md-primary">Leiser</md-button>
    </div>
    <br/><br/><br/>
    <md-divider></md-divider>

    <div layout="row" layout-align="center">
        <p>Lautstärke: {{volume / 100}}</p>
    </div>
    <div layout="row" layout-align="center">
        <p>Abspiel Counter: {{counter}}</p>
    </div>
    
</md-content>
</body>

</html>